# Flowsurface é¡¹ç›®æ¶æ„åˆ†ææ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**Flowsurface** æ˜¯ä¸€ä¸ªåŸºäº Rust + iced GUI æ¡†æ¶å¼€å‘çš„åŠ å¯†è´§å¸å®æ—¶å›¾è¡¨åº”ç”¨ç¨‹åºã€‚
- **æŠ€æœ¯æ ˆ**: Rust 2024 Edition, iced 0.14.0 (GUIæ¡†æ¶), rodio (éŸ³é¢‘), serde (åºåˆ—åŒ–)
- **æ”¯æŒäº¤æ˜“æ‰€**: Binance, Bybit, Hyperliquid, OKX
- **æ¶æ„æ¨¡å¼**: Workspace å¤š crate æ¶æ„ (ä¸»ç¨‹åº + data + exchange)

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„ (ä¸‰å±‚ç»“æ„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸»åº”ç”¨å±‚ (src/)                         â”‚
â”‚  â€¢ GUIæ¸²æŸ“ã€ç”¨æˆ·äº¤äº’ã€çª—å£ç®¡ç†                              â”‚
â”‚  â€¢ å›¾è¡¨ç»˜åˆ¶ (Canvas)ã€ç»„ä»¶è§†å›¾                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å±‚ (data/)                           â”‚
â”‚  â€¢ æ•°æ®èšåˆã€é…ç½®ç®¡ç†ã€åºåˆ—åŒ–                               â”‚
â”‚  â€¢ å›¾è¡¨æ•°æ®ç»“æ„ã€æŒ‡æ ‡è®¡ç®—                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 äº¤æ˜“æ‰€å±‚ (exchange/)                      â”‚
â”‚  â€¢ WebSocketè¿æ¥ã€REST API                               â”‚
â”‚  â€¢ é€‚é…å™¨æ¨¡å¼ (Binance/Bybit/Hyperliquid/OKX)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ è¯¦ç»†ç›®å½•ç»“æ„ä¸ç»„ä»¶å…³ç³»

### 1ï¸âƒ£ ä¸»åº”ç”¨å±‚ `src/` - GUIä¸ä¸šåŠ¡é€»è¾‘

```
src/
â”œâ”€â”€ main.rs                    # ã€å…¥å£æ–‡ä»¶ã€‘åº”ç”¨å¯åŠ¨ã€çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ struct Flowsurface     # å…¨å±€çŠ¶æ€å®¹å™¨
â”‚       â”œâ”€â”€ main_window        # ä¸»çª—å£
â”‚       â”œâ”€â”€ sidebar            # ä¾§è¾¹æ ï¼ˆäº¤æ˜“å¯¹é€‰æ‹©ï¼‰
â”‚       â”œâ”€â”€ layout_manager     # å¸ƒå±€ç®¡ç†å™¨
â”‚       â”œâ”€â”€ theme_editor       # ä¸»é¢˜ç¼–è¾‘å™¨
â”‚       â””â”€â”€ audio_stream       # éŸ³é¢‘æµç®¡ç†
â”‚
â”œâ”€â”€ ğŸ“Š chart/                  # ã€æ ¸å¿ƒã€‘å›¾è¡¨æ¸²æŸ“å±‚
â”‚   â”œâ”€â”€ chart.rs              # âœ… å›¾è¡¨åŸºç±» trait Chart + é€šç”¨é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ ViewState         # è§†å›¾çŠ¶æ€ï¼ˆç¼©æ”¾ã€å¹³ç§»ã€è¾¹ç•Œï¼‰
â”‚   â”‚   â”œâ”€â”€ Interaction       # äº¤äº’æ¨¡å¼ï¼ˆç¼©æ”¾/å¹³ç§»/æ ‡å°ºï¼‰
â”‚   â”‚   â”œâ”€â”€ canvas_interaction() # Canvasäº‹ä»¶å¤„ç†
â”‚   â”‚   â””â”€â”€ update() / view()  # æ›´æ–°ä¸æ¸²æŸ“
â”‚   â”‚
â”‚   â”œâ”€â”€ heatmap.rs            # âœ… çƒ­åŠ›å›¾å®ç° (Historical DOM)
â”‚   â”‚   â””â”€â”€ impl Chart for Heatmap
â”‚   â”‚
â”‚   â”œâ”€â”€ kline.rs              # âœ… Kçº¿å›¾å®ç° (èœ¡çƒ›å›¾)
â”‚   â”‚   â””â”€â”€ impl Chart for Kline
â”‚   â”‚
â”‚   â”œâ”€â”€ comparison.rs         # âœ… å¯¹æ¯”å›¾å®ç° (å¤šæºæ•°æ®å¯¹æ¯”)
â”‚   â”‚
â”‚   â”œâ”€â”€ indicator/            # ğŸ“ˆ æŒ‡æ ‡å­æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ indicator.rs      # æŒ‡æ ‡åŸºç±»
â”‚   â”‚   â”œâ”€â”€ kline/            # Kçº¿æŒ‡æ ‡
â”‚   â”‚   â”‚   â”œâ”€â”€ volume.rs     # æˆäº¤é‡
â”‚   â”‚   â”‚   â””â”€â”€ open_interest.rs # æŒä»“é‡
â”‚   â”‚   â””â”€â”€ plot/             # ç»˜å›¾åŸè¯­
â”‚   â”‚       â”œâ”€â”€ bar.rs        # æŸ±çŠ¶å›¾
â”‚   â”‚       â””â”€â”€ line.rs       # æŠ˜çº¿å›¾
â”‚   â”‚
â”‚   â””â”€â”€ scale/                # åæ ‡è½´ç³»ç»Ÿ
â”‚       â”œâ”€â”€ linear.rs         # çº¿æ€§åæ ‡è½´
â”‚       â””â”€â”€ timeseries.rs     # æ—¶é—´åºåˆ—è½´
â”‚
â”œâ”€â”€ ğŸ“± screen/                 # ç•Œé¢å±å¹•
â”‚   â””â”€â”€ dashboard/            # ä¸»é¢æ¿
â”‚       â”œâ”€â”€ dashboard.rs      # âœ… Dashboardæ ¸å¿ƒé€»è¾‘
â”‚       â”‚   â”œâ”€â”€ struct Dashboard  # é¢æ¿ç½‘æ ¼ã€æµè®¢é˜…
â”‚       â”‚   â”œâ”€â”€ panes: PaneGrid  # çª—æ ¼ç½‘æ ¼å¸ƒå±€
â”‚       â”‚   â””â”€â”€ streams: UniqueStreams  # æ•°æ®æµç®¡ç†
â”‚       â”‚
â”‚       â”œâ”€â”€ pane.rs           # å•ä¸ªçª—æ ¼çŠ¶æ€
â”‚       â”œâ”€â”€ sidebar.rs        # ä¾§è¾¹æ ç»„ä»¶
â”‚       â”œâ”€â”€ tickers_table.rs  # äº¤æ˜“å¯¹åˆ—è¡¨
â”‚       â”‚
â”‚       â””â”€â”€ panel/            # ç‰¹æ®Šé¢æ¿ç±»å‹
â”‚           â”œâ”€â”€ ladder.rs     # DOMæ·±åº¦é¢æ¿
â”‚           â””â”€â”€ timeandsales.rs  # æˆäº¤è®°å½•é¢æ¿
â”‚
â”œâ”€â”€ ğŸ¨ modal/                  # å¼¹çª—æ¨¡æ€æ¡†
â”‚   â”œâ”€â”€ layout_manager.rs     # å¸ƒå±€ç®¡ç†å¼¹çª—
â”‚   â”œâ”€â”€ theme_editor.rs       # ä¸»é¢˜ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ audio.rs              # éŸ³é¢‘è®¾ç½®
â”‚   â””â”€â”€ pane/                 # çª—æ ¼è®¾ç½®å¼¹çª—
â”‚       â”œâ”€â”€ settings.rs
â”‚       â”œâ”€â”€ stream.rs
â”‚       â””â”€â”€ indicators.rs
â”‚
â”œâ”€â”€ ğŸ¨ widget/                 # è‡ªå®šä¹‰ç»„ä»¶
â”‚   â”œâ”€â”€ chart.rs              # å›¾è¡¨ç»„ä»¶å°è£…
â”‚   â”œâ”€â”€ toast.rs              # é€šçŸ¥æç¤º
â”‚   â”œâ”€â”€ multi_split.rs        # å¤šåˆ†å±ç»„ä»¶
â”‚   â”œâ”€â”€ color_picker.rs       # é¢œè‰²é€‰æ‹©å™¨
â”‚   â””â”€â”€ decorate.rs           # è£…é¥°å™¨
â”‚
â”œâ”€â”€ ğŸ¨ style.rs                # ã€æ ·å¼ç³»ç»Ÿã€‘
â”‚   â”œâ”€â”€ å­—ä½“å®šä¹‰ (AZERET_MONO, ICONS)
â”‚   â”œâ”€â”€ å›¾æ ‡æšä¸¾ (Icon)
â”‚   â”œâ”€â”€ ä¸»é¢˜æ ·å¼å‡½æ•°
â”‚   â””â”€â”€ âš ï¸ æ— å›½é™…åŒ–æ”¯æŒï¼ˆç¡¬ç¼–ç æ–‡æœ¬ï¼‰
â”‚
â”œâ”€â”€ layout.rs                 # å¸ƒå±€åŠ è½½/ä¿å­˜
â”œâ”€â”€ audio.rs                  # éŸ³é¢‘æ’­æ”¾
â”œâ”€â”€ window.rs                 # çª—å£ç®¡ç†
â””â”€â”€ logger.rs                 # æ—¥å¿—ç³»ç»Ÿ
```

---

### 2ï¸âƒ£ æ•°æ®å±‚ `data/` - æ•°æ®ç»“æ„ä¸ä¸šåŠ¡é€»è¾‘

```
data/src/
â”œâ”€â”€ lib.rs                    # æ•°æ®å±‚å…¥å£
â”‚   â”œâ”€â”€ data_path()           # æ•°æ®æ–‡ä»¶è·¯å¾„
â”‚   â”œâ”€â”€ read_from_file()      # çŠ¶æ€åŠ è½½
â”‚   â””â”€â”€ cleanup_old_market_data()  # æ•°æ®æ¸…ç†
â”‚
â”œâ”€â”€ ğŸ“Š chart/                  # å›¾è¡¨æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ heatmap.rs            # âœ… çƒ­åŠ›å›¾æ•°æ®ç»“æ„
â”‚   â”‚   â”œâ”€â”€ struct HeatmapDataPoint  # å•ä¸ªæ—¶é—´ç‚¹æ•°æ®
â”‚   â”‚   â”œâ”€â”€ struct HistoricalDepth   # å†å²æ·±åº¦æ•°æ®
â”‚   â”‚   â””â”€â”€ struct OrderRun   # è®¢å•è¿è¡Œè®°å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ kline.rs              # âœ… Kçº¿æ•°æ®ç»“æ„
â”‚   â”‚   â”œâ”€â”€ struct KlineDataPoint    # Kçº¿æ•°æ®ç‚¹
â”‚   â”‚   â”œâ”€â”€ struct KlineTrades       # äº¤æ˜“è¶³è¿¹
â”‚   â”‚   â””â”€â”€ struct GroupedTrades     # èšåˆäº¤æ˜“
â”‚   â”‚
â”‚   â”œâ”€â”€ indicator.rs          # æŒ‡æ ‡é…ç½®
â”‚   â””â”€â”€ comparison.rs         # å¯¹æ¯”å›¾é…ç½®
â”‚
â”œâ”€â”€ ğŸ“ˆ aggr/                   # æ•°æ®èšåˆå±‚
â”‚   â”œâ”€â”€ time.rs               # âœ… æ—¶é—´èšåˆ (TimeAggregator)
â”‚   â”‚   â””â”€â”€ ç®¡ç†æ—¶é—´åºåˆ—æ•°æ®ç‚¹
â”‚   â””â”€â”€ ticks.rs              # âœ… Tickèšåˆ (TickAggregator)
â”‚       â””â”€â”€ ç®¡ç†åŸºäºäº¤æ˜“æ•°é‡çš„èšåˆ
â”‚
â”œâ”€â”€ âš™ï¸ config/                 # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ state.rs              # ã€æ ¸å¿ƒã€‘åº”ç”¨çŠ¶æ€åºåˆ—åŒ–
â”‚   â”‚   â”œâ”€â”€ struct State      # å…¨å±€çŠ¶æ€
â”‚   â”‚   â””â”€â”€ struct Layouts    # å¸ƒå±€é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ theme.rs              # ä¸»é¢˜é…ç½®
â”‚   â”œâ”€â”€ timezone.rs           # æ—¶åŒºè®¾ç½®
â”‚   â””â”€â”€ sidebar.rs            # ä¾§è¾¹æ é…ç½®
â”‚
â”œâ”€â”€ ğŸ“¦ layout/                 # å¸ƒå±€æŒä¹…åŒ–
â”‚   â”œâ”€â”€ dashboard.rs          # Dashboardåºåˆ—åŒ–
â”‚   â””â”€â”€ pane.rs               # çª—æ ¼é…ç½®
â”‚       â””â”€â”€ enum ContentKind  # å†…å®¹ç±»å‹ï¼ˆHeatmap/Klineç­‰ï¼‰
â”‚
â”œâ”€â”€ panel/                    # é¢æ¿æ•°æ®
â”‚   â”œâ”€â”€ ladder.rs
â”‚   â””â”€â”€ timeandsales.rs
â”‚
â””â”€â”€ util.rs                   # å·¥å…·å‡½æ•°
```

---

### 3ï¸âƒ£ äº¤æ˜“æ‰€å±‚ `exchange/` - æ•°æ®æºé€‚é…

```
exchange/src/
â”œâ”€â”€ lib.rs                    # äº¤æ˜“æ‰€æ ¸å¿ƒç±»å‹
â”‚   â”œâ”€â”€ enum Exchange         # äº¤æ˜“æ‰€æšä¸¾
â”‚   â”œâ”€â”€ struct Ticker         # äº¤æ˜“å¯¹
â”‚   â”œâ”€â”€ struct TickerInfo     # äº¤æ˜“å¯¹ä¿¡æ¯
â”‚   â”œâ”€â”€ struct Trade          # äº¤æ˜“æ•°æ®
â”‚   â”œâ”€â”€ struct Kline          # Kçº¿æ•°æ®
â”‚   â””â”€â”€ enum Timeframe        # æ—¶é—´å‘¨æœŸ
â”‚
â”œâ”€â”€ ğŸ”Œ adapter/                # ã€é€‚é…å™¨æ¨¡å¼ã€‘
â”‚   â”œâ”€â”€ adapter.rs            # é€‚é…å™¨traitå®šä¹‰
â”‚   â”‚   â”œâ”€â”€ trait StreamKind
â”‚   â”‚   â””â”€â”€ enum Event        # WebSocketäº‹ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ binance.rs            # âœ… Binanceé€‚é…å™¨
â”‚   â”œâ”€â”€ bybit.rs              # âœ… Bybité€‚é…å™¨
â”‚   â”œâ”€â”€ hyperliquid.rs        # âœ… Hyperliquidé€‚é…å™¨
â”‚   â””â”€â”€ okex.rs               # âœ… OKXé€‚é…å™¨
â”‚
â”œâ”€â”€ connect.rs                # WebSocketè¿æ¥ç®¡ç†
â”œâ”€â”€ depth.rs                  # è®¢å•ç°¿æ·±åº¦æ•°æ®
â”œâ”€â”€ fetcher.rs                # å†å²æ•°æ®è·å–
â”‚   â””â”€â”€ æ”¯æŒBinance REST APIè·å–å†å²äº¤æ˜“
â”‚
â”œâ”€â”€ limiter.rs                # é€Ÿç‡é™åˆ¶å™¨
â””â”€â”€ util.rs                   # å·¥å…·å‡½æ•° (Price, PriceStepç­‰)
```

---

## ğŸ”„ ç»„ä»¶ä¹‹é—´çš„æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ
   â†“
main.rs (Flowsurface::update)
   â†“
   â”œâ”€â†’ Dashboard::update         ã€ä¸šåŠ¡é€»è¾‘ã€‘
   â”‚    â”œâ”€â†’ Pane::update         æ›´æ–°å•ä¸ªçª—æ ¼
   â”‚    â”‚    â””â”€â†’ chart::update   å›¾è¡¨çŠ¶æ€å˜æ›´
   â”‚    â”‚
   â”‚    â””â”€â†’ streams.subscribe    è®¢é˜…æ–°æ•°æ®æµ
   â”‚
   â””â”€â†’ exchange::connect         ã€æ•°æ®è·å–ã€‘
        â†“
   WebSocket Event â†’ Message::MarketWsEvent
        â†“
   Dashboard::update_depth_and_trades
        â†“
   TimeAggregator/TickAggregator ã€æ•°æ®èšåˆã€‘
        â†“
   chart::view â†’ Canvas::draw    ã€æ¸²æŸ“ã€‘
```

---

## ğŸ¯ å…³é”®æŠ€æœ¯ç‚¹åˆ†æ

### âœ… å›¾è¡¨ç³»ç»Ÿæ¶æ„ (é‡ç‚¹ï¼)

#### 1. **æŠ½è±¡å±‚ (`src/chart.rs`)**
- **trait Chart**: æ‰€æœ‰å›¾è¡¨ç±»å‹çš„ç»Ÿä¸€æ¥å£
  ```rust
  pub trait Chart: PlotConstants + canvas::Program<Message> {
      fn state(&self) -> &ViewState;
      fn mut_state(&mut self) -> &mut ViewState;
      fn invalidate_all(&mut self);
      fn view_indicators(&'_ self, enabled: &[Self::IndicatorKind]) -> Vec<Element<'_, Message>>;
  }
  ```
- **ViewState**: ç»Ÿä¸€çš„è§†å›¾çŠ¶æ€ç®¡ç†ï¼ˆç¼©æ”¾ã€å¹³ç§»ã€åæ ‡ç³»ï¼‰
- **Interaction**: äº¤äº’æ¨¡å¼æšä¸¾ï¼ˆPanning/Zoomin/Rulerï¼‰

#### 2. **å…·ä½“å›¾è¡¨å®ç°**
| å›¾è¡¨ç±»å‹ | æ¸²æŸ“æ–‡ä»¶ | æ•°æ®æ–‡ä»¶ | è¯´æ˜ |
|---------|---------|---------|------|
| **Heatmap** | `src/chart/heatmap.rs` | `data/chart/heatmap.rs` | çƒ­åŠ›å›¾ï¼Œæ˜¾ç¤ºå†å²DOM |
| **Kline** | `src/chart/kline.rs` | `data/chart/kline.rs` | Kçº¿å›¾+Footprint |
| **Comparison** | `src/chart/comparison.rs` | `data/chart/comparison.rs` | å¤šå¸ç§å¯¹æ¯” |

#### 3. **æ•°æ®èšåˆæœºåˆ¶**
- **TimeAggregator** (`data/aggr/time.rs`): åŸºäºæ—¶é—´çš„æ•°æ®èšåˆ
- **TickAggregator** (`data/aggr/ticks.rs`): åŸºäºäº¤æ˜“æ•°é‡çš„èšåˆ
- **trait DataPoint**: ç»Ÿä¸€æ•°æ®ç‚¹æ¥å£
  ```rust
  pub trait DataPoint {
      fn add_trade(&mut self, trade: &Trade, step: PriceStep);
      fn last_price(&self) -> Price;
      fn kline(&self) -> Option<&Kline>;
  }
  ```

#### 4. **æ‰©å±•å›¾è¡¨çš„æ­¥éª¤**
1. åœ¨ `data/chart/` åˆ›å»ºæ•°æ®æ¨¡å‹ (å®ç° `DataPoint`)
2. åœ¨ `src/chart/` åˆ›å»ºæ¸²æŸ“é€»è¾‘ (å®ç° `Chart` trait)
3. åœ¨ `data/layout/pane.rs` çš„ `ContentKind` æ·»åŠ æšä¸¾é¡¹
4. åœ¨ `screen/dashboard/pane.rs` æ·»åŠ å¯¹åº”çš„ UI é€»è¾‘

---

### âš ï¸ å›½é™…åŒ–ç°çŠ¶åˆ†æ

**å½“å‰çŠ¶æ€**: âŒ **å®Œå…¨æ— å›½é™…åŒ–æ”¯æŒ**
- æ‰€æœ‰æ–‡æœ¬ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼ˆä¸»è¦åœ¨ `src/style.rs`, `src/main.rs`, `src/screen/`ï¼‰
- ç¤ºä¾‹ï¼š
  ```rust
  // src/main.rs:499
  text("Waiting for data...").size(16)
  
  // src/modal/layout_manager.rs
  text("Layout name").size(14)
  ```

**å›½é™…åŒ–æ”¹é€ å»ºè®®**:
1. **å¼•å…¥ i18n crate**
   ```toml
   [dependencies]
   rust-i18n = "3.0"  # æˆ– fluent-rs
   ```

2. **åˆ›å»ºç¿»è¯‘æ–‡ä»¶ç»“æ„**
   ```
   locales/
   â”œâ”€â”€ en-US.json     # è‹±æ–‡
   â”œâ”€â”€ zh-CN.json     # ç®€ä½“ä¸­æ–‡
   â””â”€â”€ ja-JP.json     # æ—¥æ–‡
   ```

3. **ä¿®æ”¹ä»£ç ä½ç½®**
   - `src/style.rs`: æå–æ‰€æœ‰ UI æ ‡ç­¾æ–‡æœ¬
   - `src/main.rs`: æå–èœå•ã€æŒ‰é’®æ–‡æœ¬
   - `src/modal/`: æå–æ‰€æœ‰å¼¹çª—æ–‡æœ¬
   - `src/screen/dashboard/`: æå–å›¾è¡¨æ ‡ç­¾

4. **å›½é™…åŒ–APIç¤ºä¾‹**
   ```rust
   // ä¿®æ”¹å‰
   text("Waiting for data...")
   
   // ä¿®æ”¹å
   text(t!("chart.waiting_for_data"))
   ```

---

### ğŸ—‚ï¸ æ•°æ®å±‚å‰¥ç¦»å»ºè®®

**å½“å‰è€¦åˆé—®é¢˜**:
- âœ… **å·²éƒ¨åˆ†å‰¥ç¦»**: `data/` crate ç‹¬ç«‹å­˜åœ¨
- âš ï¸ **ä»å­˜åœ¨è€¦åˆ**:
  1. `data/chart/` ç›´æ¥ä¾èµ– `exchange::Trade`
  2. `src/chart/` åŒæ—¶ä¾èµ– `data::` å’Œ `exchange::`
  3. GUIé€»è¾‘ä¸æ•°æ®èšåˆæ··æ‚åœ¨ `screen/dashboard/pane.rs`

**ä¼˜åŒ–æ–¹æ¡ˆ**:

#### æ–¹æ¡ˆä¸€ï¼šå®Œå…¨åˆ†å±‚ï¼ˆæ¨èï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GUI Layer (src/)          â”‚  åªå¤„ç†æ¸²æŸ“å’Œäº¤äº’
â”‚   â†“ åªä¾èµ– DTO              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Business Logic (data/)    â”‚  ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è®¡ç®—
â”‚   â†“ å®šä¹‰æ•°æ®æ¥å£            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Data Source (exchange/)   â”‚  æ•°æ®è·å–ã€é€‚é…å™¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…·ä½“æ”¹é€ **:
1. **åˆ›å»º DTO å±‚** (`data/dto/`)
   ```rust
   // data/dto/chart.rs
   pub struct ChartDataDTO {
       pub timestamps: Vec<u64>,
       pub prices: Vec<f32>,
       pub volumes: Vec<f32>,
   }
   ```

2. **ä¿®æ”¹ `data/chart/` ä¾èµ–**
   - ç§»é™¤å¯¹ `exchange::Trade` çš„ç›´æ¥ä¾èµ–
   - ä½¿ç”¨ trait æŠ½è±¡æ•°æ®æº
   ```rust
   // data/chart/mod.rs
   pub trait TradeProvider {
       fn get_trades(&self, range: Range<u64>) -> Vec<GenericTrade>;
   }
   ```

3. **è°ƒæ•´ `src/chart/` èŒè´£**
   - åªè´Ÿè´£ Canvas ç»˜åˆ¶
   - æ¥æ”¶å·²å¤„ç†çš„ DTO æ•°æ®
   - ç§»é™¤ä¸šåŠ¡é€»è¾‘åˆ° `data/`

---

## ğŸ“ é…ç½®ä¸çŠ¶æ€ç®¡ç†

### çŠ¶æ€æŒä¹…åŒ–
- **æ–‡ä»¶è·¯å¾„**: `~/.local/share/flowsurface/saved-state.json` (Linux)
- **æ ¸å¿ƒç»“æ„**: `data::config::state::State`
  ```rust
  pub struct State {
      layouts: Layouts,          // å¸ƒå±€é…ç½®
      theme: Theme,              // ä¸»é¢˜
      timezone: UserTimezone,    // æ—¶åŒº
      sidebar: Sidebar,          // ä¾§è¾¹æ çŠ¶æ€
      scale_factor: ScaleFactor, // UIç¼©æ”¾
      audio_cfg: AudioStream,    // éŸ³é¢‘é…ç½®
      volume_size_unit: SizeUnit,// æ•°é‡å•ä½
  }
  ```

### å¸ƒå±€ç³»ç»Ÿ
- **å¸ƒå±€ç®¡ç†å™¨**: `modal::LayoutManager`
- **å¸ƒå±€å…‹éš†**: æ”¯æŒå¤åˆ¶ç°æœ‰å¸ƒå±€
- **çª—æ ¼ç½‘æ ¼**: `iced::widget::PaneGrid`
  - æ”¯æŒæ°´å¹³/å‚ç›´åˆ†å‰²
  - æ”¯æŒå¼¹å‡ºçª—å£ï¼ˆpopoutï¼‰

---

## ğŸ”§ æŠ€æœ¯æ ˆè¯¦è§£

| ç±»åˆ« | æŠ€æœ¯ | ç”¨é€” |
|-----|------|-----|
| **GUIæ¡†æ¶** | iced 0.14.0 | è·¨å¹³å°GUIï¼ŒåŸºäºwgpu |
| **Canvasç»˜åˆ¶** | iced::widget::canvas | å›¾è¡¨æ¸²æŸ“ |
| **çŠ¶æ€ç®¡ç†** | Elmæ¶æ„ | update/viewæ¨¡å¼ |
| **åºåˆ—åŒ–** | serde + serde_json | é…ç½®æŒä¹…åŒ– |
| **ç½‘ç»œ** | tokio + tungstenite | å¼‚æ­¥WebSocket |
| **éŸ³é¢‘** | rodio | äº¤æ˜“å£°éŸ³æç¤º |
| **é¢œè‰²å¤„ç†** | palette | ä¸»é¢˜é¢œè‰²ç®¡ç† |
| **æ—¥æœŸæ—¶é—´** | chrono | æ—¶é—´å¤„ç† |
| **å“ˆå¸Œè¡¨** | rustc-hash | é«˜æ€§èƒ½HashMap |

---

## ğŸš€ äºŒæ¬¡å¼€å‘å¿«é€Ÿå…¥é—¨

### 1. æ·»åŠ æ–°å›¾è¡¨ç±»å‹

**ç¤ºä¾‹ï¼šæ·»åŠ  Volume Profile å›¾è¡¨**

#### Step 1: åˆ›å»ºæ•°æ®æ¨¡å‹
```rust
// data/src/chart/volume_profile.rs
use super::DataPoint;

pub struct VolumeProfilePoint {
    pub price_levels: Vec<(Price, f32)>,
}

impl DataPoint for VolumeProfilePoint {
    fn add_trade(&mut self, trade: &Trade, step: PriceStep) {
        // å®ç°äº¤æ˜“æ•°æ®èšåˆé€»è¾‘
    }
    // ... å…¶ä»–å¿…éœ€æ–¹æ³•
}
```

#### Step 2: åˆ›å»ºæ¸²æŸ“é€»è¾‘
```rust
// src/chart/volume_profile.rs
use crate::chart::{Chart, ViewState};

pub struct VolumeProfile {
    state: ViewState,
    data: data::chart::VolumeProfilePoint,
}

impl Chart for VolumeProfile {
    type IndicatorKind = MyIndicator;
    
    fn state(&self) -> &ViewState { &self.state }
    fn mut_state(&mut self) -> &mut ViewState { &mut self.state }
    
    // å®ç° canvas::Program trait
    fn draw(&self, renderer: &mut Frame, theme: &Theme, bounds: Rectangle, cursor: Cursor) {
        // ç»˜åˆ¶é€»è¾‘
    }
}
```

#### Step 3: æ³¨å†Œåˆ°ç³»ç»Ÿ
```rust
// data/layout/pane.rs
pub enum ContentKind {
    Heatmap(/* ... */),
    Kline(/* ... */),
    VolumeProfile(/* æ–°å¢é…ç½® */),  // â† æ·»åŠ è¿™è¡Œ
}
```

---

### 2. æ·»åŠ æ–°äº¤æ˜“æ‰€

**ç¤ºä¾‹ï¼šæ·»åŠ  Coinbase æ”¯æŒ**

```rust
// exchange/src/adapter/coinbase.rs
use super::{StreamConfig, Exchange};

impl Exchange {
    Coinbase,  // åœ¨æšä¸¾ä¸­æ·»åŠ 
}

pub fn subscribe_coinbase(config: StreamConfig) -> impl Stream<Item = Event> {
    // å®ç° WebSocket è®¢é˜…é€»è¾‘
}

// åœ¨ adapter.rs ä¸­æ³¨å†Œ
pub fn connect_stream(exchange: Exchange, config: StreamConfig) {
    match exchange {
        Exchange::Binance => /* ... */,
        Exchange::Coinbase => subscribe_coinbase(config),  // â† æ·»åŠ 
    }
}
```

---

### 3. æ·»åŠ æ–°æŒ‡æ ‡

```rust
// src/chart/indicator/rsi.rs
use super::Indicator;

pub struct RSI {
    period: u32,
    values: Vec<f32>,
}

impl Indicator for RSI {
    fn calculate(&mut self, klines: &[Kline]) {
        // è®¡ç®— RSI é€»è¾‘
    }
    
    fn view(&self) -> Element<Message> {
        // ç»˜åˆ¶æŒ‡æ ‡UI
    }
}
```

---

## âš™ï¸ æ„å»ºä¸è¿è¡Œ

```bash
# å¼€å‘æ¨¡å¼
cargo run

# å‘å¸ƒæ„å»º
cargo build --release

# è¿è¡Œæµ‹è¯•
cargo test --workspace

# ä»£ç æ ¼å¼åŒ–
cargo fmt --all

# é™æ€æ£€æŸ¥
cargo clippy --workspace
```

---

## ğŸ“Œ å…³é”®æ–‡ä»¶ç´¢å¼•

### å¿…çœ‹æ–‡ä»¶ï¼ˆç†è§£æ¶æ„ï¼‰
1. `src/main.rs` - åº”ç”¨å…¥å£ï¼Œå…¨å±€çŠ¶æ€ç®¡ç†
2. `src/chart/chart.rs` - å›¾è¡¨ç³»ç»Ÿæ ¸å¿ƒæ¥å£
3. `data/src/lib.rs` - æ•°æ®å±‚å…¥å£
4. `exchange/src/lib.rs` - äº¤æ˜“æ‰€å±‚æ ¸å¿ƒç±»å‹
5. `src/screen/dashboard/dashboard.rs` - ä¸»é¢æ¿é€»è¾‘

### å›¾è¡¨ç›¸å…³
- **æ¸²æŸ“**: `src/chart/{heatmap,kline,comparison}.rs`
- **æ•°æ®**: `data/src/chart/{heatmap,kline}.rs`
- **èšåˆ**: `data/src/aggr/{time,ticks}.rs`

### é…ç½®ç›¸å…³
- **çŠ¶æ€**: `data/src/config/state.rs`
- **ä¸»é¢˜**: `data/src/config/theme.rs`
- **å¸ƒå±€**: `data/src/layout/`

---

## ğŸ” å¾…æ”¹è¿›ç‚¹

### 1. å›½é™…åŒ–
- [ ] æå–ç¡¬ç¼–ç æ–‡æœ¬åˆ°ç¿»è¯‘æ–‡ä»¶
- [ ] é›†æˆ i18n crate
- [ ] æ”¯æŒè¯­è¨€åˆ‡æ¢

### 2. æ•°æ®å±‚è§£è€¦
- [ ] åˆ›å»º DTO å±‚
- [ ] æŠ½è±¡æ•°æ®æºæ¥å£
- [ ] åˆ†ç¦»ä¸šåŠ¡é€»è¾‘å’ŒGUI

### 3. æµ‹è¯•è¦†ç›–
- [ ] æ·»åŠ å•å…ƒæµ‹è¯• (æ•°æ®èšåˆé€»è¾‘)
- [ ] æ·»åŠ é›†æˆæµ‹è¯• (WebSocket è¿æ¥)
- [ ] æ·»åŠ  UI æµ‹è¯•

### 4. æ–‡æ¡£
- [ ] API æ–‡æ¡£ (rustdoc)
- [ ] å¼€å‘æŒ‡å—
- [ ] æ¶æ„å†³ç­–è®°å½• (ADR)

---

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

1. **ä¿®æ”¹å›¾è¡¨æ—¶**: åŒæ—¶æ›´æ–° `src/chart/` å’Œ `data/chart/`
2. **æ·»åŠ é…ç½®é¡¹**: åœ¨ `data/config/state.rs` æ·»åŠ å­—æ®µï¼Œç¡®ä¿åºåˆ—åŒ–å…¼å®¹
3. **æ·»åŠ äº¤æ˜“æ‰€**: éµå¾ª Adapter æ¨¡å¼ï¼Œå‚è€ƒç°æœ‰å®ç°
4. **æ€§èƒ½ä¼˜åŒ–**: å…³æ³¨ `ViewState::visible_region()` åªæ¸²æŸ“å¯è§åŒºåŸŸ
5. **æ—¥å¿—è®°å½•**: ä½¿ç”¨ `log::info/warn/error` å®

---

## ğŸ“§ æŠ€æœ¯æ”¯æŒ

- **GitHub**: https://github.com/flowsurface-rs/flowsurface
- **æ–‡æ¡£**: æœ¬æ–‡æ¡£åŸºäº v0.8.6 ç‰ˆæœ¬
- **æ›´æ–°æ—¥æœŸ**: 2025-12-25

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ç”±ä»£ç è‡ªåŠ¨åˆ†æç”Ÿæˆï¼Œå»ºè®®ä¸å®é™…ä»£ç ç»“åˆé˜…è¯»ã€‚

